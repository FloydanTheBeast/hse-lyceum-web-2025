---
theme: default
title: Python - дополнительные главы / Курс по веб-разработке, 11 класс
class: text-center
drawings:
  persist: false
transition: slide-left
mdc: true
fonts:
  sans: Montserrat
hideInToc: true
---

# Курс по веб-разработке

<h2 class="color-gray-400 fw-200">Python - аннотации, модули, пакеты и асинхронное программирование</h2>

---
hideInToc: true
---

# Содержание

<Toc />

---
transition: none
---

# Python

Модули

<div class="flex flex-col gap-4">

> **Точка входа** - основной файл программы, который запускается при помощи интерпретатора. Для неё специальная переменная `__name__` будет равна `__main__`

> **Модуль** - файл с расширением `.py`, содержащий какую-то часть программы и импортируемый в главный файл или другой модуль. Каждый модуль определяет собственное **пространство имён** - место, где хранятся все переменные, по сути просто словарь со всеми переменными, функциями и классами, определёнными в файле модуля.

<div class="grid grid-cols-3 gap-2">

```py
# Импорт всего модуля 'module'
import module

module.<smth>
```

<div>

```py
# Импорт конкретных объявлений
from sys import path, version as ver
# Относительный (relative) импорт
from ..config import settings

print(path, ver)
```

<p class="color-gray-300 font-size-3 mt-0" style="line-height: 1rem; margin-top: 4px">
<b>Абсолютные</b> импорты (без точки(ек) в начале) происходят относительно директории со входной точкой программы, <b>относительные</b> - относительно самого файла с импортом
</p>

</div>

<div>

```py
# Импорт всех объявлений
from sys import *

print(path, version, argv)
```

<p class="color-red-500 font-size-3 mt-0" style="line-height: 1rem; margin-top: 4px">
Такой способ лучше не использовать, так как он может привести к множеству конфликтов
</p>

</div>

</div>

</div>

---
hideInToc: true
---

# Python

Модули

### Для чего нужны модули

- Организация программы (чтобы не писать весь код в одном файле)
- Переиспользования кода
- Позволяют избежать конфликтов имён
- Они делают код более читаемым и поддерживаемым

<h3 class="mt-4">Алгоритм поиска импортируемого модуля</h3>

- Поиск встроенного (built-in) модуля с указанным названием (все встроенные модули перечислены в `sys.builtin_module_names`)
- Поиск модуля в директориях, указанных в `sys.path`

---
hideInToc: true
---

# Python

Пакеты

> **Пакет** - директория, содержащая файл `__init__.py` (в нём находится код, который автоматически исполнится при первом импорте модуля из этого каталога. Может содержать импорты или код для инициализации, например подключение к базе данных) и **python-модули**. Нужны для составления **иерархии проекта**.

<div class="mt-4">

```
├── app.py                      Входная точка
├── controllers                 Пакет
│   ├── __init__.py
│   └── users_controller.py     Модуль
└── utils                       Пакет
    ├── __init__.py
    ├── fs.py                   Модуль
    └── images                  Пакет
        ├── __init__.py
        ├── croper.py           Модуль
        └── resizer.py          Модуль
```

</div>

<p class="font-size-4">
Для того, чтобы ограничить импортируемые из модуля/пакета имена при помощи <code >from <> import *</code>, в модуле или в файле <code>__init__.py</code> соответственно мы можем указать конкретный массив имён для импорта - <code>__all__ = ['имя1', 'имя2', ...]</code>
</p>

---
hideInToc: true
---

# Python

Работа с внешними зависимостями

<div class="mb-2">

> Для работы с внешними зависимостями (пакетами) в python есть собственный менеджер пакетов - `pip`

</div>

> Список и версии установленных для проекта пакетов принято хранить в файле `requirements.txt`

<div class="font-size-3 grid grid-cols-2 gap-4">

<div>

Пример файла `requirements.txt`:

```
MarkupSafe==1.1.1
aiohttp==3.10.10
cryptography==43.0.3
Faker==24.7.1
Jinja2==3.1.4
numpy==2.1.3
pandas==2.2.3
pre_commit==4.0.1
psycopg==3.2.3
pylint==3.3.1
requests==2.32.3
```

</div>

<div>

Основные команды для работы с `pip`:

- `pip install <название_пакета>` - установка зависимостей
- `pip list` - вывод списка установленных зависимостей
- `pip freeze` - вывод списка установленных зависимостей в формате файла `requirements.txt`
- `pip freeze > requirements.txt` - сохранение списка установленных зависимостей в файле `requirements.txt`
- `pip install -r requirements.txt` - установка зависимостей, перечисленных в файле `requirements.txt`
- `pip uninstall <название>` - удаление зависимости

</div>

</div>

[PyPI - Python Package Index - Индекс пакетов Python](https://pypi.org/)

---
hideInToc: true
---

# Python

Виртуальные среды

> **Виртуальная среда (Virtual Environment)** - изолированный "проект", содержащий собственный набор зависимостей и локальный интерпретатор, необходимые для работы программы

Для работы с виртуальными окружениями используется модуль `venv` в стандартной библиотеке python. Команды для терминала:
- `python -m venv <название>` - создание виртуального окружения
- `<название>\\Scripts\\activate` (Win) или `source <название>/bin/activate` (MacOS/Linux) - активация окружения
- `deactivate` - деактивация окружения для использования глобального интерпретатора

---
transition: none
hideInToc: true
---

# Python

Аннотации типов (Type Hints)

> **Python** - язык с динамической типизацией, но при помощи аннотаций типов можно усилить типобезопасность. Они являются подсказками для статических анализаторов и разработчиков о том, с какими типами работает программа

```py
annotated_type: int = 5
```

Поддерживаются аннотации:

- Типов переменных
- Полей классов
- Аргументов и возвращаемых значений функций

Инструменты, поддерживающие аннотации:

- Различные IDE (PyCharm, VSCode и другие)
- Линтеры (pylint, mypy и другие)

---
transition: none
hideInToc: true
---

# Python

Аннотации типов

<<< @/../snippets/type-annotations.py {*}{maxHeight: '400px'}

---
hideInToc: true
---

# Python

Аннотации типов. Пользовательские и обобщённые (generics) типы

<<< @/../snippets/custom-type-annotations.py {*}{maxHeight: '400px'}

---
transition: none
hideInToc: true
---

# Python

Асинхронное (неблокирующее) программирование

> **Асинхронное программирование** - подход, позволяющий дожидаться долгих задач (**I/O операций** (Input/output - Ввод/Вывод), например: ожадание ответа от сервера, подключения к БД, чтение/запись файлов), не прерывая процесса исполнения всей программы и продолжая выполнять другие задачи.


<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="420" viewBox="0 0 1200 420" class="mt-4 scale-70 transform-origin-lt">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#fff"/>
    </marker>
  </defs>

  <!-- Заголовки -->
  <text x="270" y="36" font-size="7" fill="#fff" text-anchor="middle">Синхронное программирование</text>
  <text x="930" y="36" font-size="7" fill="#fff" text-anchor="middle">Асинхронное программирование</text>

  <!-- ====== ЛЕВАЯ ПАНЕЛЬ (синхронное) ====== -->
  <!-- Шапки -->
  <rect x="130" y="58" rx="10" ry="10" width="130" height="42" fill="#22c55e" stroke="#fff"/>
  <text x="195" y="84" font-size="4" text-anchor="middle" stroke="#fff">клиент</text>

  <rect x="352" y="58" rx="10" ry="10" width="130" height="42" fill="#3b82f6" stroke="#fff"/>
  <text x="417" y="84" font-size="4" text-anchor="middle" fill="#fff">сервер</text>

  <!-- Жизненные линии -->
  <circle cx="195" cy="112" r="5" fill="#fff"/>
  <line x1="195" y1="117" x2="195" y2="392" stroke="#fff" z-index="10"/>
  <path d="M195,392 l0,15" stroke="#fff" marker-end="url(#arrow)"/>

  <circle cx="417" cy="112" r="5" fill="#fff"/>
  <line x1="417" y1="117" x2="417" y2="392" stroke="#fff"/>
  <path d="M417,392 l0,15" stroke="#fff" marker-end="url(#arrow)"/>

  <!-- Подписи слева -->
  <text x="70" y="142" font-size="4" stroke="#fff">выполняет</text>
  <text x="70" y="160" font-size="4" stroke="#fff">программу</text>
  <text x="70" y="222" font-size="4" stroke="#fff">ждёт</text>
  <text x="70" y="240" font-size="4" stroke="#fff">ответа</text>
  <text x="70" y="362" font-size="4" stroke="#fff">выполняет</text>
  <text x="70" y="380" font-size="4" stroke="#fff">программу</text>

  <!-- Активности клиента (синхрон) -->
  <rect x="176" y="125" rx="10" ry="10" width="38" height="30" fill="#22c55e" stroke="#fff"/>
  <!-- пауза ожидания -->
  <!-- нижняя активность после ответа -->
  <rect x="176" y="305" rx="10" ry="10" width="38" height="80" fill="#22c55e" stroke="#fff"/>

  <!-- Вызов -->
  <text x="230" y="128" font-size="4" stroke="#fff">отправил запрос</text>
  <text x="230" y="150" font-size="4" stroke="#fff">во внешнюю систему</text>

  <!-- Обработка сервера -->
  <rect x="403" y="165" width="28" height="125" fill="#3b82f6" stroke="#fff"/>
  <line x1="195" y1="165" x2="417" y2="165" stroke="#fff" marker-end="url(#arrow)"/>
  <text x="440" y="215" font-size="4" stroke="#fff">обработка</text>
  <text x="440" y="233" font-size="4" stroke="#fff">запроса</text>

  <!-- Ответ -->
  <line x1="417" y1="290" x2="195" y2="290" stroke="#fff" marker-end="url(#arrow)"/>
  <text x="260" y="320" font-size="4" stroke="#fff">получил</text>
  <text x="260" y="338" font-size="4" stroke="#fff">ответ</text>

  <!-- ====== ПРАВАЯ ПАНЕЛЬ (асинхронное) ====== -->
  <!-- Шапки -->
  <rect x="790" y="58" rx="10" ry="10" width="130" height="42" fill="#22c55e" stroke="#fff"/>
  <text x="855" y="84" font-size="4" text-anchor="middle" stroke="#fff">клиент</text>

  <rect x="1012" y="58" rx="10" ry="10" width="130" height="42" fill="#3b82f6" stroke="#fff"/>
  <text x="1077" y="84" font-size="4" text-anchor="middle" fill="#fff">сервер</text>

  <!-- Жизненные линии -->
  <circle cx="855" cy="112" r="5" fill="#fff"/>
  <line x1="855" y1="117" x2="855" y2="392" stroke="#fff"/>
  <path d="M855,392 l0,15" stroke="#fff" marker-end="url(#arrow)"/>

  <circle cx="1077" cy="112" r="5" fill="#fff"/>
  <line x1="1077" y1="117" x2="1077" y2="392" stroke="#fff"/>
  <path d="M1077,392 l0,15" stroke="#fff" marker-end="url(#arrow)"/>

  <!-- Подписи справа -->
  <text x="730" y="142" font-size="4" stroke="#fff">выполняет</text>
  <text x="730" y="160" font-size="4" stroke="#fff">программу</text>
  <text x="730" y="214" font-size="4" stroke="#fff">выполняет</text>
  <text x="730" y="232" font-size="4" stroke="#fff">программу</text>
  <text x="730" y="362" font-size="4" stroke="#fff">выполняет</text>
  <text x="730" y="380" font-size="4" stroke="#fff">программу</text>

  <!-- Активности клиента (несколько во время ожидания) -->
  <rect x="836" y="125" rx="10" ry="10" width="38" height="30" fill="#22c55e" stroke="#fff"/>
  <rect x="836" y="175" rx="10" ry="10" width="38" height="100" fill="#22c55e" stroke="#fff"/>
  <rect x="836" y="305" rx="10" ry="10" width="38" height="80" fill="#22c55e" stroke="#fff"/>

  <!-- Вызов -->
  <text x="890" y="130" font-size="4" stroke="#fff">отправил запрос</text>
  <text x="890" y="154" font-size="4" stroke="#fff">во внешнюю систему</text>

  <!-- Обработка сервера -->
  <rect x="1063" y="165" width="28" height="125" fill="#3b82f6" stroke="#fff"/>
  <line x1="855" y1="165" x2="1077" y2="165" stroke="#fff" marker-end="url(#arrow)"/>
  <text x="1100" y="215" font-size="4" stroke="#fff">обработка</text>
  <text x="1100" y="233" font-size="4" stroke="#fff">запроса</text>

  <!-- Ответ -->
  <line x1="1077" y1="290" x2="855" y2="290" stroke="#fff" marker-end="url(#arrow)"/>
  <text x="930" y="320" font-size="4" stroke="#fff">получил</text>
  <text x="930" y="338" font-size="4" stroke="#fff">ответ</text>
</svg>

---
hideInToc: true
---

<style scoped>
  li {
    font-size: 14px;
  }

  li p {
    margin: 6px 0;
  }
</style>

# Python


Асинхронное (неблокирующее) программирование

В `python` для асинхронности используется стандартная библиотека `asyncio`

### Определения
- **Блокирующая операция** - операция, блокирущая выполнение другого кода в текущем потоке программы, примеры: консольный вывод/вывод, http-запросы при помощи `requests`, чтение и запись файлов стандартной библиотекой

- **Корутина (Coroutine - Сопрограмма)** - это специальный объект, позволяющий приостанавливать выполнение функции и возобновлять его позже, при этом сохраняя своё состояние, позволяя выполняться другим операциям

- **Асинхронная функция** - функция, объявленная при помощи `async def`. Всегда неявно возвращает экземпляр `<class 'coroutine'>` и позволяет использовать внутри себя ключевое слово `await` для ожидания результата объекта, реализующего интерфейс `awaitable` (например, `Future` или другая корутина)


- **Цикл событиый (Event Loop)** - механизм, управляющий выполнением всех асинхронных задач, то есть решает, когда запустить новую корутину, когда приостановить или возобновить уже существующую

- **Задача (Task)** - объект, управляющий независимым выполнением корутины в цикле событий. Создаётся при помощи `asyncio.create_task()`. Примерно то же самое, что `Promise` в JS

---
hideInToc: true
---

# Python

Пример-сравнение синхронной и асинхронной программы

<div class="grid grid-cols-2 gap-4">

<<< @/../snippets/python/sync-async/sync-simple.py {*}{maxHeight: '400px'}

<<< @/../snippets/python/sync-async/async-simple.py {*}{maxHeight: '400px'}

</div>


---

<style scoped>
  h4 {
    font-size: 18px;
    font-weight: 600;
  }

  p, li {
    font-size: 14px;
    line-height: 1.1rem;
    font-weight: 400;
  }
</style>

# Практика

<div class="grid grid-cols-2 gap-4">
  
  <div>

#### 1. Знание языка

Напишите программу, принимающую 2 IP-адреса в качестве аргументов командой строки и выведите, сколько адресов находится между ними (включая начало и исключая конец)

  <div class="mb-2">

```sh
python ips-between.py 192.168.0.100 192.168.0.0 # 100
python ips-between.py 192.168.1.0 192.168.0.5 # 251
```

</div>

  - Обработайте ошибки (неправильный ввод, плюсик за использование регулярных выражений)
  - Если пользователь передал флаг `-h`, выведите информацию о программе и как ей пользоваться
  </div>

  <div>

#### 2. Асинхронность и внешние зависимости

Напишите программу для мониторинга веб-сайтов, которая периодически определяет: **доступность сайта, время ответа от сервера и заголовок страницы**

Основные условия:
  - Создана виртуальная среда
  - Зависимости описаны в файле `requirements.txt`
  - Запросы выполняются асинхронно
  - Адреса сайтов хранятся в константе
  - Программа разбита на модули и пакеты (как именно - на ваше усмотрение)

Дополнительные условия:
  - Адреса сайтов могут задаваться из файла (по адресу на каждой строке) или в качестве аргументов командной строки через пробел
  - Данные сохраняются в CSV (тоже асинхронно)
  - Если очень уж хотите, можете попробовать строить сравнительные графики с временами ответов (можно отдельной программой)

  </div>

</div>


---
src: ./_shared.md#1
---

---

# Дополнительные материалы

### Python
- [Python Type Annotations Full Guide](https://missourimrr.github.io/docs/python/type-annotations/full-guide.html)
- [PEP 484 - Type Hints](https://peps.python.org/pep-0484/)
